<!-- admin_alpatex/templates/admin_alpatex/usuarios.html -->
{% extends "admin_alpatex/base.html" %}
{% load static %}

{% block body %}

  <h1 class="prod-dest">Usuarios Registrados</h1>

  <form method="get" class="filtros-user-admin">
    
    <input type="text" name="q" placeholder="Buscar usuario..." value="{{ request.GET.q }}">
    
    <select name="membresia">
      <option value="">Todas las membresías</option>
      <option value="Plata" {% if request.GET.membresia == 'Plata' %}selected{% endif %}>Plata</option>
      <option value="Oro" {% if request.GET.membresia == 'Oro' %}selected{% endif %}>Oro</option>
      <option value="Sin membresía" {% if request.GET.membresia == 'Sin membresía' %}selected{% endif %}>Sin membresía</option>
    </select>
    
    <button type="submit" class="btn">Filtrar</button>

  </form>

  <div class="admin-users">

    {% for usuario in usuarios %}

      <div class="user-card">

        <div class="perfil-foto">
          <img src="{{ usuario.perfil.get_foto_perfil_url }}" alt="Foto de perfil">
          {% if usuario.perfil.membresia %}
            {% if usuario.perfil.membresia.nombre == 'Plata' %}
              <img src="{% static 'img/plata.png' %}" class="marco-membresia" alt="Marco Plata">
            {% elif usuario.perfil.membresia.nombre == 'Oro' %}
              <img src="{% static 'img/oro.png' %}" class="marco-membresia" alt="Marco Oro">
            {% endif %}
          {% endif %}
        </div>

        <div class="card-body">
          <h5 class="card-title">{{ usuario.username }}</h5>
          
          <p class="card-text"><strong>Dirección:</strong> {{ usuario.perfil.direccion }}</p>

          <div class="acciones-usuario">
            <a href="{% url 'perfil_usuario' username=usuario.username %}" class="btn btn-ver">Ver Perfil</a>
            
             <button type="button" class="btn btn-danger btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#modalEliminar{{ usuario.id }}">
                Eliminar
              </button>

  <!-- Modal de confirmación con motivo -->
            <div class="modal fade" id="modalEliminar{{ usuario.id }}" tabindex="-1" aria-labelledby="modalLabel{{ usuario.id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <form method="post" action="{% url 'eliminar_usuario' usuario.id %}">
                    {% csrf_token %}
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalLabel{{ usuario.id }}">Eliminar Usuario</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                      <p>¿Estás seguro de que deseas eliminar al usuario <strong>{{ usuario.username }}</strong>?</p>
                      <div class="mb-3">
                        <label for="motivo{{ usuario.id }}" class="form-label">Motivo de la eliminación</label>
                        <textarea name="motivo" id="motivo{{ usuario.id }}" class="form-control" rows="3" required></textarea>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-danger">Eliminar</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    {% endfor %}

  </div>

{% endblock %}
