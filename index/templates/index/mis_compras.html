{% extends "index/base.html" %}
{% load static %}
{% block title %}Mis Compras{% endblock %}

{% block body %}
    <div class="reg-btn">
        <a href="{% url 'perfil_usuario' %}" class="regresar">
            <span class="material-symbols-outlined">chevron_left</span> Regresar
        </a>
    </div>
    <h1 class="prod-dest">Mis Pendientes</h1>
    {% if pendientes %}
        <div class="list-prod">
            {% for confirmacion in pendientes %}
                <div class="list-prod-item">
                    <div class="img-prod">
                        {% if confirmacion.producto.imagen %}
                        <img src="{{ confirmacion.producto.imagen.url }}" alt="{{ confirmacion.producto.nombre }}"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default_product.png' %}" alt="Sin imagen"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div class="info">
                        <strong>Producto: {{ confirmacion.producto.nombre }}</strong><br>
                        <small>Fecha: {{ confirmacion.fecha }}</small><br>
                        <small>Hora: {{ confirmacion.hora }}</small><br>
                        <small>Lugar: {{ confirmacion.lugar }}</small><br>
                        <small>Creado por: {{ confirmacion.creador.username }}</small><br>
                        <small>Creado en: {{ confirmacion.creado_en|date:"d M Y H:i" }}</small><br>
                        {% if not confirmacion.concretado %}
                            <span style="color:red; font-weight:bold;">❌ No se concretó</span>
                        {% elif confirmacion.confirmado %}
                            <span style="color:green; font-weight:bold;">✔ Entrega Confirmada</span>
                        {% else %}
                            <span style="color:orange; font-weight:bold;">⏳ Pendiente de Confirmación</span>
                        {% endif %}
                    </div>

                    {% if confirmacion.creador == request.user %}
						<div class="actions">
							<a href="{% url 'editar_confirmacion' confirmacion.id %}" class="btn btn-warning">Editar</a>
							<form action="{% url 'eliminar_confirmacion' confirmacion.id %}" method="POST" style="display:inline;">
								{% csrf_token %}
								<button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de eliminar esta confirmación?');">
									Eliminar
								</button>
							</form>
						</div>
					{% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No tienes confirmaciones pendientes.</p>
    {% endif %}

    <h1 class="prod-dest">Mis Compras</h1>
    {% if compras %}
        <div class="list-prod">
            {% for confirmacion in compras %}
                <div class="list-prod-item">
                    <div class="img-prod">
                        {% if confirmacion.producto.imagen %}
                        <img src="{{ confirmacion.producto.imagen.url }}" alt="{{ confirmacion.producto.nombre }}"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default_product.png' %}" alt="Sin imagen"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div class="info">
                        <strong>Producto: {{ confirmacion.producto.nombre }}</strong><br>
                        <small>Fecha: {{ confirmacion.fecha }}</small><br>
                        <small>Hora: {{ confirmacion.hora }}</small><br>
                        <small>Lugar: {{ confirmacion.lugar }}</small><br>
                        <small>Creado por: {{ confirmacion.creador.username }}</small><br>
                        <small>Creado en: {{ confirmacion.creado_en|date:"d M Y H:i" }}</small><br>

                        {% if confirmacion.confirmado %}
                            <span style="color:green; font-weight:bold;">✔ Entrega Confirmada</span>
                        {% else %}
                            <span style="color:orange; font-weight:bold;">⏳ Pendiente de Confirmación</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No has comprado productos aún.</p>
    {% endif %}

    <h1 class="prod-dest">Mis Intercambios</h1>
    {% if intercambios %}
        <div class="list-prod">
            {% for confirmacion in intercambios %}
                <div class="list-prod-item">
                    <div class="img-prod">
                        {% if confirmacion.producto.imagen %}
                        <img src="{{ confirmacion.producto.imagen.url }}" alt="{{ confirmacion.producto.nombre }}"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default_product.png' %}" alt="Sin imagen"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div class="info">
                        <strong>Producto: {{ confirmacion.producto.nombre }}</strong><br>
                        <small>Fecha: {{ confirmacion.fecha }}</small><br>
                        <small>Hora: {{ confirmacion.hora }}</small><br>
                        <small>Lugar: {{ confirmacion.lugar }}</small><br>
                        <small>Creado por: {{ confirmacion.creador.username }}</small><br>
                        <small>Creado en: {{ confirmacion.creado_en|date:"d M Y H:i" }}</small><br>

                        {% if confirmacion.confirmado %}
                            <span style="color:green; font-weight:bold;">✔ Entrega Confirmada</span>
                        {% else %}
                            <span style="color:orange; font-weight:bold;">⏳ Pendiente de Confirmación</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No has realizado intercambios aún.</p>
    {% endif %}

    <h1 class="prod-dest">Mis Productos</h1>
    {% if mis_productos %}
        <div class="list-prod">
            {% for confirmacion in mis_productos %}
                <div class="list-prod-item">
                    <div class="img-prod">
                        {% if confirmacion.producto.imagen %}
                        <img src="{{ confirmacion.producto.imagen.url }}" alt="{{ confirmacion.producto.nombre }}"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default_product.png' %}" alt="Sin imagen"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div class="info">
                        <strong>Producto: {{ confirmacion.producto.nombre }}</strong><br>
                        <small>Fecha: {{ confirmacion.fecha }}</small><br>
                        <small>Hora: {{ confirmacion.hora }}</small><br>
                        <small>Lugar: {{ confirmacion.lugar }}</small><br>
                        <small>Creado por: {{ confirmacion.creador.username }}</small><br>
                        <small>Creado en: {{ confirmacion.creado_en|date:"d M Y H:i" }}</small><br>

                        {% if confirmacion.confirmado %}
                            <span style="color:green; font-weight:bold;">✔ Entrega Confirmada</span>
                        {% else %}
                            <span style="color:orange; font-weight:bold;">⏳ Pendiente de Confirmación</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No has vendido ni intercambiado productos aún.</p>
    {% endif %}

    <h1 class="prod-dest">No Realizados</h1>
    {% if reportados %}
        <div class="list-prod">
            {% for confirmacion in reportados %}
                <div class="list-prod-item">
                    <div class="img-prod">
                        {% if confirmacion.producto.imagen %}
                        <img src="{{ confirmacion.producto.imagen.url }}" alt="{{ confirmacion.producto.nombre }}"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default_product.png' %}" alt="Sin imagen"
                            style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div class="info">
                        <strong>Producto: {{ confirmacion.producto.nombre }}</strong><br>
                        <small>Fecha: {{ confirmacion.fecha }}</small><br>
                        <small>Hora: {{ confirmacion.hora }}</small><br>
                        <small>Lugar: {{ confirmacion.lugar }}</small><br>
                        <small>Creado por: {{ confirmacion.creador.username }}</small><br>
                        <small>Creado en: {{ confirmacion.creado_en|date:"d M Y H:i" }}</small><br>

                        <span style="color:red; font-weight:bold;">❌ No se concretó</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No has realizado reportes aún.</p>
    {% endif %}
{% endblock %}